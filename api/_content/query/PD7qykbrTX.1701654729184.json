{"_path":"/blog/2020-12-06-progress-update-for-age-of-aincrad-com","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"Progress update for age-of-aincrad.com","description":"This is a progress update on my work for the new homepage for age-of-aincrad.com.","createdAt":"2020-12-06T16:00:00.000Z","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As the year progresses further, so do I with the new homepage for age-of-aincrad.com.\nIn my last post, I explained how I came to working on the new website and what the (then) current state was."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this post, I want to let you know what issues I encountered since then and how I solved them."}]},{"type":"element","tag":"h2","props":{"id":"task-management"},"children":[{"type":"text","value":"Task Management"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Internally at Team Cardinal (the developers of the Age of Aincrad game), we use Trello and Discord to communicate and organize tasks.\nThis is also the way Leo (community lead) and Blacky/Katy (the project leads) tell us web developers what they want for the website."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now since I've been working on the new website, we have been using GitHub.\nAs you may know, GitHub has its own issue/task management, including \"projects\" and milestones and so on.\nPersonally, I really like to use those systems because it allows you to create intuitive workflows and automate things as much as possible (which in turn minimizes need for manual labor)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A problem which could arise when using both systems is that they can become out of sync, meaning the issue on GitHub is closed while a card on Trello remains in \"ToDo\" (or vice versa).\nTo mitigate this, we decided to separate the different systems based on who is interested in the information provided by each system."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So if the project leads want a new feature or adjust the design, they can open a new Trello card.\nWe will then open a new (more technically detailed) GitHub issue with a link to this Trello card and work on the issue while discussing everything technical in the GitHub issue.\nThe Trello card must then be moved according to the state of the issue."}]},{"type":"element","tag":"h2","props":{"id":"automatic-deployment"},"children":[{"type":"text","value":"Automatic Deployment"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Part of the things I wanted for the new website is an automatic deployment system, so we don't have to manually build or move files around."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I set up a workflow with GitHub actions, which simply executes "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"npm run build"}]},{"type":"text","value":" after a push event.\nThis way, we can automatically check if the current codebase is even able to be built.\nAfterwards, all available tests are executed using "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"npm run test"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we need a way to deploy the latest version.\nTo achieve this, I installed "},{"type":"element","tag":"a","props":{"href":"https://github.com/olipo186/Git-Auto-Deploy","rel":["nofollow"]},"children":[{"type":"text","value":"olipo186/Git-Auto-Deploy"}]},{"type":"text","value":" on the deployment server.\nHere is the description in the current README.md:"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Git-Auto-Deploy consists of a small HTTP server that listens for Webhook requests sent from GitHub, GitLab or Bitbucket servers. This application allows you to continuously and automatically deploy your projects each time you push new commits to your repository."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So it seems to be perfect for the use-case.\nThe setup was pretty simple:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"create a new subdomain which will be called by GitHub with the webhook events"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"create a reverse proxy to forward the requests to the Git-Auto-Deploy service"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"create a deployment script which builds and deploys the website on the server"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"configure the Git-Auto-Deploy service to only deploy on certain events"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The deployment script was a challenge because I am not very familiar with bash scripting.\nIn the end I managed to create a pretty stable script which checks the environments "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"node"}]},{"type":"text","value":" versions and uses symlinking for a zero-downtime deployment.\nI ran into a problem where the script wouldn't be executable, because it was missing the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"x"}]},{"type":"text","value":" permission."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"EDIT"}]},{"type":"text","value":": I wanted to make the script publicly available, so "},{"type":"element","tag":"a","props":{"href":"https://gist.github.com/ricardoboss/de05920c5296e851490743d03d1158c8","rel":["nofollow"]},"children":[{"type":"text","value":"here is a gist of it"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This could be fixed by changing my git config to respect file modes:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"$ git config --global core.filemode true\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" git"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" config"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" --global"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" core.filemode"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" true\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then, I needed to add the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"x"}]},{"type":"text","value":" flag and commit the script:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"$ chmod +x ./bin/deploy.sh\n$ git commit -am \"Add +x flag to deploy script\"\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" chmod"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" +x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" ./bin/deploy.sh\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" git"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" commit"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -am"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" \"Add +x flag to deploy script\"\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Afterwards the service happily ran my script with no problems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next I had to decide on which events would trigger a deployment.\nI went for the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"check_suite"}]},{"type":"text","value":" event, which is triggered every time a workflow starts or completes.\nAdditional filters for branches and the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"success"}]},{"type":"text","value":" state of the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"check_suite"}]},{"type":"text","value":" where added, and the configuration was complete."}]},{"type":"element","tag":"h2","props":{"id":"conclusion-and-further-development"},"children":[{"type":"text","value":"Conclusion and further development"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The next steps in the development of the website will prepare it for it's initial release (hopefully late January).\nThis means filling everything with content, fixing open issues, adding required features, testing everything and so on.\nThere is still a lot to do, but I think we can make it until early next year."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Again, I will post a new update here once we have made significant progress.\nThanks for reading!"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"task-management","depth":2,"text":"Task Management"},{"id":"automatic-deployment","depth":2,"text":"Automatic Deployment"},{"id":"conclusion-and-further-development","depth":2,"text":"Conclusion and further development"}]}},"_type":"markdown","_id":"content:blog:2020-12-06-progress-update-for-age-of-aincrad-com.md","_source":"content","_file":"blog/2020-12-06-progress-update-for-age-of-aincrad-com.md","_extension":"md"}